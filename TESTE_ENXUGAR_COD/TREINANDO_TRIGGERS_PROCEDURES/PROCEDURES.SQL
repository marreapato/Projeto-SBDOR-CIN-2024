CREATE OR REPLACE PROCEDURE CONTAR_PAX_COMPRA(P_ID_COMPRA COMPRA_TB.ID_COMPRA%TYPE)
IS
    V_TOTAL_NA_PASSAGEM NUMBER;
BEGIN
    SELECT COUNT(R.PASSAGEM.PK_LOCALIZADOR_PASSAGEM) INTO V_TOTAL_NA_PASSAGEM FROM COMPRA_TB C, TABLE(C.PASSAGENS_COMPRADAS) R WHERE C.ID_COMPRA= P_ID_COMPRA;
	DBMS_OUTPUT.PUT_LINE('TOTAL DE PASSAGEIROS: '||V_TOTAL_NA_PASSAGEM);

END CONTAR_PAX_COMPRA;

EXEC CONTAR_PAX_COMPRA(2);

CREATE OR REPLACE PROCEDURE ELEVATE_VALUES_PASSAGEM IS
    CURSOR C_MENOR_IDADE IS SELECT M.PK_CPF, M.ACOMPANHAMENTO_ESPECIAL FROM MENOR_IDADE_TB M;
BEGIN
    FOR C_MENOR IN C_MENOR_IDADE LOOP

    	IF C_MENOR.ACOMPANHAMENTO_ESPECIAL = 'sim' THEN
    		UPDATE PASSAGEM_TB P SET P.VALOR_PASSAGEM = P.VALOR_PASSAGEM*1.1 WHERE DEREF(P.PASSAGEIRO).PK_CPF= C_MENOR.PK_CPF;
		END IF;
    END LOOP;
    
END ELEVATE_VALUES_PASSAGEM;


SELECT P.PK_LOCALIZADOR_PASSAGEM,DEREF(P.PASSAGEIRO).PK_CPF AS PK_CPF,P.VALOR_PASSAGEM FROM PASSAGEM_TB P;
EXEC ELEVATE_VALUES_PASSAGEM;

SELECT * FROM MENOR_IDADE_TB;
